'use strict';
var angular;
/*jslint nomen: true unparam: true regexp: true*/

angular.module('app').controller('rgiAssessmentAdminCtrl', function ($scope, ngDialog, rgiAssessmentSrvc, rgiUserListSrvc) {
    // filtering options
    $scope.sortOptions = [
        {value: 'country', text: 'Sort by Country'},
        {value: 'start_date', text: 'Date started'},
        {value: 'status', text: 'Status'},
        {value: 'year', text: 'Year of assessment'},
        {value: 'version', text: 'Version'}
    ];
    $scope.sortOrder = $scope.sortOptions[0].value;

    rgiAssessmentSrvc.query(function (data) {
        // pull assessment list from collection and adds user name to match reviewer id and researcher id
        var assessment;
        $scope.assessments = [];

        data.forEach(function (el, i) {
            assessment = {
                assessment_ID: el.assessment_ID,
                country: el.country,
                researcher_ID: el.researcher_ID,
                reviewer_ID: el.reviewer_ID,
                start_date: el.start_date,
                version: el.version,
                year: el.year,
                status: el.status
            };
            if (el.modified[0] !== undefined) {
                assessment.modified = el.modified;
                assessment.edited_by = rgiUserListSrvc.get({_id: el.modified[el.modified.length - 1].modified_by});
            }
            if (assessment.reviewer_ID !== undefined) {
                assessment.reviewer = rgiUserListSrvc.get({_id: assessment.reviewer_ID});
                assessment.researcher = rgiUserListSrvc.get({_id: assessment.researcher_ID});
            }
            $scope.assessments.push(assessment);
        });
    });

    // Deploy new assessment
    $scope.newAssessmentDialog = function () {
        $scope.value = true;
        ngDialog.open({
            template: 'partials/admin/assessments/new-assessment-dialog',
            controller: 'assessmentDialogCtrl',
            className: 'ngdialog-theme-plain',
            scope: $scope
        });
    };
});

angular.module('app').controller('assessmentDialogCtrl', function ($scope, $location, rgiNotifier, ngDialog, rgiAssessmentMethodSrvc, rgiQuestionSrvc, rgiQuestionMethodSrvc) {
    // $scope.countries = [{'iso2': 'AF', 'country': 'AFGHANISTAN'}, {'iso2': 'AX', 'country': 'ÅLAND ISLANDS'}, {'iso2': 'AL', 'country': 'ALBANIA'}, {'iso2': 'DZ', 'country': 'ALGERIA'}, {'iso2': 'AS', 'country': 'AMERICAN SAMOA'}, {'iso2': 'AD', 'country': 'ANDORRA'}, {'iso2': 'AO', 'country': 'ANGOLA'}, {'iso2': 'AI', 'country': 'ANGUILLA'}, {'iso2': 'AQ', 'country': 'ANTARCTICA'}, {'iso2': 'AG', 'country': 'ANTIGUA AND BARBUDA'}, {'iso2': 'AR', 'country': 'ARGENTINA'}, {'iso2': 'AM', 'country': 'ARMENIA'}, {'iso2': 'AW', 'country': 'ARUBA'}, {'iso2': 'AU', 'country': 'AUSTRALIA'}, {'iso2': 'AT', 'country': 'AUSTRIA'}, {'iso2': 'AZ', 'country': 'AZERBAIJAN'}, {'iso2': 'BS', 'country': 'BAHAMAS'}, {'iso2': 'BH', 'country': 'BAHRAIN'}, {'iso2': 'BD', 'country': 'BANGLADESH'}, {'iso2': 'BB', 'country': 'BARBADOS'}, {'iso2': 'BY', 'country': 'BELARUS'}, {'iso2': 'BE', 'country': 'BELGIUM'}, {'iso2': 'BZ', 'country': 'BELIZE'}, {'iso2': 'BJ', 'country': 'BENIN'}, {'iso2': 'BM', 'country': 'BERMUDA'}, {'iso2': 'BT', 'country': 'BHUTAN'}, {'iso2': 'BO', 'country': 'BOLIVIA, PLURINATIONAL STATE OF'}, {'iso2': 'BQ', 'country': 'BONAIRE, SINT EUSTATIUS AND SABA'}, {'iso2': 'BA', 'country': 'BOSNIA AND HERZEGOVINA'}, {'iso2': 'BW', 'country': 'BOTSWANA'}, {'iso2': 'BV', 'country': 'BOUVET ISLAND'}, {'iso2': 'BR', 'country': 'BRAZIL'}, {'iso2': 'IO', 'country': 'BRITISH INDIAN OCEAN TERRITORY'}, {'iso2': 'BN', 'country': 'BRUNEI DARUSSALAM'}, {'iso2': 'BG', 'country': 'BULGARIA'}, {'iso2': 'BF', 'country': 'BURKINA FASO'}, {'iso2': 'BI', 'country': 'BURUNDI'}, {'iso2': 'KH', 'country': 'CAMBODIA'}, {'iso2': 'CM', 'country': 'CAMEROON'}, {'iso2': 'CA', 'country': 'CANADA'}, {'iso2': 'CV', 'country': 'CAPE VERDE'}, {'iso2': 'KY', 'country': 'CAYMAN ISLANDS'}, {'iso2': 'CF', 'country': 'CENTRAL AFRICAN REPUBLIC'}, {'iso2': 'TD', 'country': 'CHAD'}, {'iso2': 'CL', 'country': 'CHILE'}, {'iso2': 'CN', 'country': 'CHINA'}, {'iso2': 'CX', 'country': 'CHRISTMAS ISLAND'}, {'iso2': 'CC', 'country': 'COCOS (KEELING) ISLANDS'}, {'iso2': 'CO', 'country': 'COLOMBIA'}, {'iso2': 'KM', 'country': 'COMOROS'}, {'iso2': 'CG', 'country': 'CONGO'}, {'iso2': 'CD', 'country': 'CONGO, THE DEMOCRATIC REPUBLIC OF THE'}, {'iso2': 'CK', 'country': 'COOK ISLANDS'}, {'iso2': 'CR', 'country': 'COSTA RICA'}, {'iso2': 'CI', 'country': 'CÔTE D\'IVOIRE'}, {'iso2': 'HR', 'country': 'CROATIA'}, {'iso2': 'CU', 'country': 'CUBA'}, {'iso2': 'CW', 'country': 'CURAÇAO'}, {'iso2': 'CY', 'country': 'CYPRUS'}, {'iso2': 'CZ', 'country': 'CZECH REPUBLIC'}, {'iso2': 'DK', 'country': 'DENMARK'}, {'iso2': 'DJ', 'country': 'DJIBOUTI'}, {'iso2': 'DM', 'country': 'DOMINICA'}, {'iso2': 'DO', 'country': 'DOMINICAN REPUBLIC'}, {'iso2': 'EC', 'country': 'ECUADOR'}, {'iso2': 'EG', 'country': 'EGYPT'}, {'iso2': 'SV', 'country': 'EL SALVADOR'}, {'iso2': 'GQ', 'country': 'EQUATORIAL GUINEA'}, {'iso2': 'ER', 'country': 'ERITREA'}, {'iso2': 'EE', 'country': 'ESTONIA'}, {'iso2': 'ET', 'country': 'ETHIOPIA'}, {'iso2': 'FK', 'country': 'FALKLAND ISLANDS (MALVINAS)'}, {'iso2': 'FO', 'country': 'FAROE ISLANDS'}, {'iso2': 'FJ', 'country': 'FIJI'}, {'iso2': 'FI', 'country': 'FINLAND'}, {'iso2': 'FR', 'country': 'FRANCE'}, {'iso2': 'GF', 'country': 'FRENCH GUIANA'}, {'iso2': 'PF', 'country': 'FRENCH POLYNESIA'}, {'iso2': 'TF', 'country': 'FRENCH SOUTHERN TERRITORIES'}, {'iso2': 'GA', 'country': 'GABON'}, {'iso2': 'GM', 'country': 'GAMBIA'}, {'iso2': 'GE', 'country': 'GEORGIA'}, {'iso2': 'DE', 'country': 'GERMANY'}, {'iso2': 'GH', 'country': 'GHANA'}, {'iso2': 'GI', 'country': 'GIBRALTAR'}, {'iso2': 'GR', 'country': 'GREECE'}, {'iso2': 'GL', 'country': 'GREENLAND'}, {'iso2': 'GD', 'country': 'GRENADA'}, {'iso2': 'GP', 'country': 'GUADELOUPE'}, {'iso2': 'GU', 'country': 'GUAM'}, {'iso2': 'GT', 'country': 'GUATEMALA'}, {'iso2': 'GG', 'country': 'GUERNSEY'}, {'iso2': 'GN', 'country': 'GUINEA'}, {'iso2': 'GW', 'country': 'GUINEA-BISSAU'}, {'iso2': 'GY', 'country': 'GUYANA'}, {'iso2': 'HT', 'country': 'HAITI'}, {'iso2': 'HM', 'country': 'HEARD ISLAND AND MCDONALD ISLANDS'}, {'iso2': 'VA', 'country': 'HOLY SEE (VATICAN CITY STATE)'}, {'iso2': 'HN', 'country': 'HONDURAS'}, {'iso2': 'HK', 'country': 'HONG KONG'}, {'iso2': 'HU', 'country': 'HUNGARY'}, {'iso2': 'IS', 'country': 'ICELAND'}, {'iso2': 'IN', 'country': 'INDIA'}, {'iso2': 'ID', 'country': 'INDONESIA'}, {'iso2': 'IR', 'country': 'IRAN, ISLAMIC REPUBLIC OF'}, {'iso2': 'IQ', 'country': 'IRAQ'}, {'iso2': 'IE', 'country': 'IRELAND'}, {'iso2': 'IM', 'country': 'ISLE OF MAN'}, {'iso2': 'IL', 'country': 'ISRAEL'}, {'iso2': 'IT', 'country': 'ITALY'}, {'iso2': 'JM', 'country': 'JAMAICA'}, {'iso2': 'JP', 'country': 'JAPAN'}, {'iso2': 'JE', 'country': 'JERSEY'}, {'iso2': 'JO', 'country': 'JORDAN'}, {'iso2': 'KZ', 'country': 'KAZAKHSTAN'}, {'iso2': 'KE', 'country': 'KENYA'}, {'iso2': 'KI', 'country': 'KIRIBATI'}, {'iso2': 'KP', 'country': 'KOREA, DEMOCRATIC PEOPLE\'S REPUBLIC OF'}, {'iso2': 'KR', 'country': 'KOREA, REPUBLIC OF'}, {'iso2': 'KW', 'country': 'KUWAIT'}, {'iso2': 'KG', 'country': 'KYRGYZSTAN'}, {'iso2': 'LA', 'country': 'LAO PEOPLE\'S DEMOCRATIC REPUBLIC'}, {'iso2': 'LV', 'country': 'LATVIA'}, {'iso2': 'LB', 'country': 'LEBANON'}, {'iso2': 'LS', 'country': 'LESOTHO'}, {'iso2': 'LR', 'country': 'LIBERIA'}, {'iso2': 'LY', 'country': 'LIBYA'}, {'iso2': 'LI', 'country': 'LIECHTENSTEIN'}, {'iso2': 'LT', 'country': 'LITHUANIA'}, {'iso2': 'LU', 'country': 'LUXEMBOURG'}, {'iso2': 'MO', 'country': 'MACAO'}, {'iso2': 'MK', 'country': 'MACEDONIA, THE FORMER YUGOSLAV REPUBLIC OF'}, {'iso2': 'MG', 'country': 'MADAGASCAR'}, {'iso2': 'MW', 'country': 'MALAWI'}, {'iso2': 'MY', 'country': 'MALAYSIA'}, {'iso2': 'MV', 'country': 'MALDIVES'}, {'iso2': 'ML', 'country': 'MALI'}, {'iso2': 'MT', 'country': 'MALTA'}, {'iso2': 'MH', 'country': 'MARSHALL ISLANDS'}, {'iso2': 'MQ', 'country': 'MARTINIQUE'}, {'iso2': 'MR', 'country': 'MAURITANIA'}, {'iso2': 'MU', 'country': 'MAURITIUS'}, {'iso2': 'YT', 'country': 'MAYOTTE'}, {'iso2': 'MX', 'country': 'MEXICO'}, {'iso2': 'FM', 'country': 'MICRONESIA, FEDERATED STATES OF'}, {'iso2': 'MD', 'country': 'MOLDOVA, REPUBLIC OF'}, {'iso2': 'MC', 'country': 'MONACO'}, {'iso2': 'MN', 'country': 'MONGOLIA'}, {'iso2': 'ME', 'country': 'MONTENEGRO'}, {'iso2': 'MS', 'country': 'MONTSERRAT'}, {'iso2': 'MA', 'country': 'MOROCCO'}, {'iso2': 'MZ', 'country': 'MOZAMBIQUE'}, {'iso2': 'MM', 'country': 'MYANMAR'}, {'iso2': 'NA', 'country': 'NAMIBIA'}, {'iso2': 'NR', 'country': 'NAURU'}, {'iso2': 'NP', 'country': 'NEPAL'}, {'iso2': 'NL', 'country': 'NETHERLANDS'}, {'iso2': 'NC', 'country': 'NEW CALEDONIA'}, {'iso2': 'NZ', 'country': 'NEW ZEALAND'}, {'iso2': 'NI', 'country': 'NICARAGUA'}, {'iso2': 'NE', 'country': 'NIGER'}, {'iso2': 'NG', 'country': 'NIGERIA'}, {'iso2': 'NU', 'country': 'NIUE'}, {'iso2': 'NF', 'country': 'NORFOLK ISLAND'}, {'iso2': 'MP', 'country': 'NORTHERN MARIANA ISLANDS'}, {'iso2': 'NO', 'country': 'NORWAY'}, {'iso2': 'OM', 'country': 'OMAN'}, {'iso2': 'PK', 'country': 'PAKISTAN'}, {'iso2': 'PW', 'country': 'PALAU'}, {'iso2': 'PS', 'country': 'PALESTINE, STATE OF'}, {'iso2': 'PA', 'country': 'PANAMA'}, {'iso2': 'PG', 'country': 'PAPUA NEW GUINEA'}, {'iso2': 'PY', 'country': 'PARAGUAY'}, {'iso2': 'PE', 'country': 'PERU'}, {'iso2': 'PH', 'country': 'PHILIPPINES'}, {'iso2': 'PN', 'country': 'PITCAIRN'}, {'iso2': 'PL', 'country': 'POLAND'}, {'iso2': 'PT', 'country': 'PORTUGAL'}, {'iso2': 'PR', 'country': 'PUERTO RICO'}, {'iso2': 'QA', 'country': 'QATAR'}, {'iso2': 'RE', 'country': 'RÉUNION'}, {'iso2': 'RO', 'country': 'ROMANIA'}, {'iso2': 'RU', 'country': 'RUSSIAN FEDERATION'}, {'iso2': 'RW', 'country': 'RWANDA'}, {'iso2': 'BL', 'country': 'SAINT BARTHÉLEMY'}, {'iso2': 'SH', 'country': 'SAINT HELENA, ASCENSION AND TRISTAN DA CUNHA'}, {'iso2': 'KN', 'country': 'SAINT KITTS AND NEVIS'}, {'iso2': 'LC', 'country': 'SAINT LUCIA'}, {'iso2': 'MF', 'country': 'SAINT MARTIN (FRENCH PART)'}, {'iso2': 'PM', 'country': 'SAINT PIERRE AND MIQUELON'}, {'iso2': 'VC', 'country': 'SAINT VINCENT AND THE GRENADINES'}, {'iso2': 'WS', 'country': 'SAMOA'}, {'iso2': 'SM', 'country': 'SAN MARINO'}, {'iso2': 'ST', 'country': 'SAO TOME AND PRINCIPE'}, {'iso2': 'SA', 'country': 'SAUDI ARABIA'}, {'iso2': 'SN', 'country': 'SENEGAL'}, {'iso2': 'RS', 'country': 'SERBIA'}, {'iso2': 'SC', 'country': 'SEYCHELLES'}, {'iso2': 'SL', 'country': 'SIERRA LEONE'}, {'iso2': 'SG', 'country': 'SINGAPORE'}, {'iso2': 'SX', 'country': 'SINT MAARTEN (DUTCH PART)'}, {'iso2': 'SK', 'country': 'SLOVAKIA'}, {'iso2': 'SI', 'country': 'SLOVENIA'}, {'iso2': 'SB', 'country': 'SOLOMON ISLANDS'}, {'iso2': 'SO', 'country': 'SOMALIA'}, {'iso2': 'ZA', 'country': 'SOUTH AFRICA'}, {'iso2': 'GS', 'country': 'SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS'}, {'iso2': 'SS', 'country': 'SOUTH SUDAN'}, {'iso2': 'ES', 'country': 'SPAIN'}, {'iso2': 'LK', 'country': 'SRI LANKA'}, {'iso2': 'SD', 'country': 'SUDAN'}, {'iso2': 'SR', 'country': 'SURINAME'}, {'iso2': 'SJ', 'country': 'SVALBARD AND JAN MAYEN'}, {'iso2': 'SZ', 'country': 'SWAZILAND'}, {'iso2': 'SE', 'country': 'SWEDEN'}, {'iso2': 'CH', 'country': 'SWITZERLAND'}, {'iso2': 'SY', 'country': 'SYRIAN ARAB REPUBLIC'}, {'iso2': 'TW', 'country': 'TAIWAN, PROVINCE OF CHINA'}, {'iso2': 'TJ', 'country': 'TAJIKISTAN'}, {'iso2': 'TZ', 'country': 'TANZANIA, UNITED REPUBLIC OF'}, {'iso2': 'TH', 'country': 'THAILAND'}, {'iso2': 'TL', 'country': 'TIMOR-LESTE'}, {'iso2': 'TG', 'country': 'TOGO'}, {'iso2': 'TK', 'country': 'TOKELAU'}, {'iso2': 'TO', 'country': 'TONGA'}, {'iso2': 'TT', 'country': 'TRINIDAD AND TOBAGO'}, {'iso2': 'TN', 'country': 'TUNISIA'}, {'iso2': 'TR', 'country': 'TURKEY'}, {'iso2': 'TM', 'country': 'TURKMENISTAN'}, {'iso2': 'TC', 'country': 'TURKS AND CAICOS ISLANDS'}, {'iso2': 'TV', 'country': 'TUVALU'}, {'iso2': 'UG', 'country': 'UGANDA'}, {'iso2': 'UA', 'country': 'UKRAINE'}, {'iso2': 'AE', 'country': 'UNITED ARAB EMIRATES'}, {'iso2': 'GB', 'country': 'UNITED KINGDOM'}, {'iso2': 'US', 'country': 'UNITED STATES'}, {'iso2': 'UM', 'country': 'UNITED STATES MINOR OUTLYING ISLANDS'}, {'iso2': 'UY', 'country': 'URUGUAY'}, {'iso2': 'UZ', 'country': 'UZBEKISTAN'}, {'iso2': 'VU', 'country': 'VANUATU'}, {'iso2': 'VE', 'country': 'VENEZUELA, BOLIVARIAN REPUBLIC OF'}, {'iso2': 'VN', 'country': 'VIET NAM'}, {'iso2': 'VG', 'country': 'VIRGIN ISLANDS, BRITISH'}, {'iso2': 'VI', 'country': 'VIRGIN ISLANDS, U.S.'}, {'iso2': 'WF', 'country': 'WALLIS AND FUTUNA'}, {'iso2': 'EH', 'country': 'WESTERN SAHARA'}, {'iso2': 'YE', 'country': 'YEMEN'}, {'iso2': 'ZM', 'country': 'ZAMBIA'}, {'iso2': 'ZW', 'country': 'ZIMBABWE'}];
    $scope.countries = [{"country": "Afghanistan", "iso3": "AFG", "iso2": "AF"}, {"country": "Åland Islands", "iso3": "ALA", "iso2": "AX"}, {"country": "Albania", "iso3": "ALB", "iso2": "AL"}, {"country": "Algeria", "iso3": "DZA", "iso2": "DZ"}, {"country": "American Samoa", "iso3": "ASM", "iso2": "AS"}, {"country": "Andorra", "iso3": "AND", "iso2": "AD"}, {"country": "Angola", "iso3": "AGO", "iso2": "AO"}, {"country": "Anguilla", "iso3": "AIA", "iso2": "AI"}, {"country": "Antarctica", "iso3": "ATA", "iso2": "AQ"}, {"country": "Antigua and Barbuda", "iso3": "ATG", "iso2": "AG"}, {"country": "Argentina", "iso3": "ARG", "iso2": "AR"}, {"country": "Armenia", "iso3": "ARM", "iso2": "AM"}, {"country": "Aruba", "iso3": "ABW", "iso2": "AW"}, {"country": "Australia", "iso3": "AUS", "iso2": "AU"}, {"country": "Austria", "iso3": "AUT", "iso2": "AT"}, {"country": "Azerbaijan", "iso3": "AZE", "iso2": "AZ"}, {"country": "Bahamas", "iso3": "BHS", "iso2": "BS"}, {"country": "Bahrain", "iso3": "BHR", "iso2": "BH"}, {"country": "Bangladesh", "iso3": "BGD", "iso2": "BD"}, {"country": "Barbados", "iso3": "BRB", "iso2": "BB"}, {"country": "Belarus", "iso3": "BLR", "iso2": "BY"}, {"country": "Belgium", "iso3": "BEL", "iso2": "BE"}, {"country": "Belize", "iso3": "BLZ", "iso2": "BZ"}, {"country": "Benin", "iso3": "BEN", "iso2": "BJ"}, {"country": "Bermuda", "iso3": "BMU", "iso2": "BM"}, {"country": "Bhutan", "iso3": "BTN", "iso2": "BT"}, {"country": "Bolivia, Plurinational State of", "iso3": "BOL", "iso2": "BO"}, {"country": "Bonaire, Sint Eustatius and Saba", "iso3": "BES", "iso2": "BQ"}, {"country": "Bosnia and Herzegovina", "iso3": "BIH", "iso2": "BA"}, {"country": "Botswana", "iso3": "BWA", "iso2": "BW"}, {"country": "Bouvet Island", "iso3": "BVT", "iso2": "BV"}, {"country": "Brazil", "iso3": "BRA", "iso2": "BR"}, {"country": "British Indian Ocean Territory", "iso3": "IOT", "iso2": "IO"}, {"country": "Brunei Darussalam", "iso3": "BRN", "iso2": "BN"}, {"country": "Bulgaria", "iso3": "BGR", "iso2": "BG"}, {"country": "Burkina Faso", "iso3": "BFA", "iso2": "BF"}, {"country": "Burundi", "iso3": "BDI", "iso2": "BI"}, {"country": "Cambodia", "iso3": "KHM", "iso2": "KH"}, {"country": "Cameroon", "iso3": "CMR", "iso2": "CM"}, {"country": "Canada", "iso3": "CAN", "iso2": "CA"}, {"country": "Cape Verde", "iso3": "CPV", "iso2": "CV"}, {"country": "Cayman Islands", "iso3": "CYM", "iso2": "KY"}, {"country": "Central African Republic", "iso3": "CAF", "iso2": "CF"}, {"country": "Chad", "iso3": "TCD", "iso2": "TD"}, {"country": "Chile", "iso3": "CHL", "iso2": "CL"}, {"country": "China", "iso3": "CHN", "iso2": "CN"}, {"country": "Christmas Island", "iso3": "CXR", "iso2": "CX"}, {"country": "Cocos (Keeling) Islands", "iso3": "CCK", "iso2": "CC"}, {"country": "Colombia", "iso3": "COL", "iso2": "CO"}, {"country": "Comoros", "iso3": "COM", "iso2": "KM"}, {"country": "Congo", "iso3": "COG", "iso2": "CG"}, {"country": "Congo, The Democratic Republic of the", "iso3": "COD", "iso2": "CD"}, {"country": "Cook Islands", "iso3": "COK", "iso2": "CK"}, {"country": "Costa Rica", "iso3": "CRI", "iso2": "CR"}, {"country": "Côte d\"Ivoire", "iso3": "CIV", "iso2": "CI"}, {"country": "Croatia", "iso3": "HRV", "iso2": "HR"}, {"country": "Cuba", "iso3": "CUB", "iso2": "CU"}, {"country": "Curaçao", "iso3": "CUW", "iso2": "CW"}, {"country": "Cyprus", "iso3": "CYP", "iso2": "CY"}, {"country": "Czech Republic", "iso3": "CZE", "iso2": "CZ"}, {"country": "Denmark", "iso3": "DNK", "iso2": "DK"}, {"country": "Djibouti", "iso3": "DJI", "iso2": "DJ"}, {"country": "Dominica", "iso3": "DMA", "iso2": "DM"}, {"country": "Dominican Republic", "iso3": "DOM", "iso2": "DO"}, {"country": "Ecuador", "iso3": "ECU", "iso2": "EC"}, {"country": "Egypt", "iso3": "EGY", "iso2": "EG"}, {"country": "El Salvador", "iso3": "SLV", "iso2": "SV"}, {"country": "Equatorial Guinea", "iso3": "GNQ", "iso2": "GQ"}, {"country": "Eritrea", "iso3": "ERI", "iso2": "ER"}, {"country": "Estonia", "iso3": "EST", "iso2": "EE"}, {"country": "Ethiopia", "iso3": "ETH", "iso2": "ET"}, {"country": "Falkland Islands (Malvinas)", "iso3": "FLK", "iso2": "FK"}, {"country": "Faroe Islands", "iso3": "FRO", "iso2": "FO"}, {"country": "Fiji", "iso3": "FJI", "iso2": "FJ"}, {"country": "Finland", "iso3": "FIN", "iso2": "FI"}, {"country": "France", "iso3": "FRA", "iso2": "FR"}, {"country": "French Guiana", "iso3": "GUF", "iso2": "GF"}, {"country": "French Polynesia", "iso3": "PYF", "iso2": "PF"}, {"country": "French Southern Territories", "iso3": "ATF", "iso2": "TF"}, {"country": "Gabon", "iso3": "GAB", "iso2": "GA"}, {"country": "Gambia", "iso3": "GMB", "iso2": "GM"}, {"country": "Georgia", "iso3": "GEO", "iso2": "GE"}, {"country": "Germany", "iso3": "DEU", "iso2": "DE"}, {"country": "Ghana", "iso3": "GHA", "iso2": "GH"}, {"country": "Gibraltar", "iso3": "GIB", "iso2": "GI"}, {"country": "Greece", "iso3": "GRC", "iso2": "GR"}, {"country": "Greenland", "iso3": "GRL", "iso2": "GL"}, {"country": "Grenada", "iso3": "GRD", "iso2": "GD"}, {"country": "Guadeloupe", "iso3": "GLP", "iso2": "GP"}, {"country": "Guam", "iso3": "GUM", "iso2": "GU"}, {"country": "Guatemala", "iso3": "GTM", "iso2": "GT"}, {"country": "Guernsey", "iso3": "GGY", "iso2": "GG"}, {"country": "Guinea", "iso3": "GIN", "iso2": "GN"}, {"country": "Guinea-Bissau", "iso3": "GNB", "iso2": "GW"}, {"country": "Guyana", "iso3": "GUY", "iso2": "GY"}, {"country": "Haiti", "iso3": "HTI", "iso2": "HT"}, {"country": "Heard Island and McDonald Islands", "iso3": "HMD", "iso2": "HM"}, {"country": "Holy See (Vatican City State)", "iso3": "VAT", "iso2": "VA"}, {"country": "Honduras", "iso3": "HND", "iso2": "HN"}, {"country": "Hong Kong", "iso3": "HKG", "iso2": "HK"}, {"country": "Hungary", "iso3": "HUN", "iso2": "HU"}, {"country": "Iceland", "iso3": "ISL", "iso2": "IS"}, {"country": "India", "iso3": "IND", "iso2": "IN"}, {"country": "Indonesia", "iso3": "IDN", "iso2": "ID"}, {"country": "Iran, Islamic Republic of", "iso3": "IRN", "iso2": "IR"}, {"country": "Iraq", "iso3": "IRQ", "iso2": "IQ"}, {"country": "Ireland", "iso3": "IRL", "iso2": "IE"}, {"country": "Isle of Man", "iso3": "IMN", "iso2": "IM"}, {"country": "Israel", "iso3": "ISR", "iso2": "IL"}, {"country": "Italy", "iso3": "ITA", "iso2": "IT"}, {"country": "Jamaica", "iso3": "JAM", "iso2": "JM"}, {"country": "Japan", "iso3": "JPN", "iso2": "JP"}, {"country": "Jersey", "iso3": "JEY", "iso2": "JE"}, {"country": "Jordan", "iso3": "JOR", "iso2": "JO"}, {"country": "Kazakhstan", "iso3": "KAZ", "iso2": "KZ"}, {"country": "Kenya", "iso3": "KEN", "iso2": "KE"}, {"country": "Kiribati", "iso3": "KIR", "iso2": "KI"}, {"country": "Korea, Democratic People's Republic of", "iso3": "PRK", "iso2": "KP"}, {"country": "Korea, Republic of", "iso3": "KOR", "iso2": "KR"}, {"country": "Kuwait", "iso3": "KWT", "iso2": "KW"}, {"country": "Kyrgyzstan", "iso3": "KGZ", "iso2": "KG"}, {"country": "Lao People's Democratic Republic", "iso3": "LAO", "iso2": "LA"}, {"country": "Latvia", "iso3": "LVA", "iso2": "LV"}, {"country": "Lebanon", "iso3": "LBN", "iso2": "LB"}, {"country": "Lesotho", "iso3": "LSO", "iso2": "LS"}, {"country": "Liberia", "iso3": "LBR", "iso2": "LR"}, {"country": "Libya", "iso3": "LBY", "iso2": "LY"}, {"country": "Liechtenstein", "iso3": "LIE", "iso2": "LI"}, {"country": "Lithuania", "iso3": "LTU", "iso2": "LT"}, {"country": "Luxembourg", "iso3": "LUX", "iso2": "LU"}, {"country": "Macao", "iso3": "MAC", "iso2": "MO"}, {"country": "Macedonia, Republic of", "iso3": "MKD", "iso2": "MK"}, {"country": "Madagascar", "iso3": "MDG", "iso2": "MG"}, {"country": "Malawi", "iso3": "MWI", "iso2": "MW"}, {"country": "Malaysia", "iso3": "MYS", "iso2": "MY"}, {"country": "Maldives", "iso3": "MDV", "iso2": "MV"}, {"country": "Mali", "iso3": "MLI", "iso2": "ML"}, {"country": "Malta", "iso3": "MLT", "iso2": "MT"}, {"country": "Marshall Islands", "iso3": "MHL", "iso2": "MH"}, {"country": "Martinique", "iso3": "MTQ", "iso2": "MQ"}, {"country": "Mauritania", "iso3": "MRT", "iso2": "MR"}, {"country": "Mauritius", "iso3": "MUS", "iso2": "MU"}, {"country": "Mayotte", "iso3": "MYT", "iso2": "YT"}, {"country": "Mexico", "iso3": "MEX", "iso2": "MX"}, {"country": "Micronesia, Federated States of", "iso3": "FSM", "iso2": "FM"}, {"country": "Moldova, Republic of", "iso3": "MDA", "iso2": "MD"}, {"country": "Monaco", "iso3": "MCO", "iso2": "MC"}, {"country": "Mongolia", "iso3": "MNG", "iso2": "MN"}, {"country": "Montenegro", "iso3": "MNE", "iso2": "ME"}, {"country": "Montserrat", "iso3": "MSR", "iso2": "MS"}, {"country": "Morocco", "iso3": "MAR", "iso2": "MA"}, {"country": "Mozambique", "iso3": "MOZ", "iso2": "MZ"}, {"country": "Myanmar", "iso3": "MMR", "iso2": "MM"}, {"country": "Namibia", "iso3": "NAM", "iso2": "NA"}, {"country": "Nauru", "iso3": "NRU", "iso2": "NR"}, {"country": "Nepal", "iso3": "NPL", "iso2": "NP"}, {"country": "Netherlands", "iso3": "NLD", "iso2": "NL"}, {"country": "New Caledonia", "iso3": "NCL", "iso2": "NC"}, {"country": "New Zealand", "iso3": "NZL", "iso2": "NZ"}, {"country": "Nicaragua", "iso3": "NIC", "iso2": "NI"}, {"country": "Niger", "iso3": "NER", "iso2": "NE"}, {"country": "Nigeria", "iso3": "NGA", "iso2": "NG"}, {"country": "Niue", "iso3": "NIU", "iso2": "NU"}, {"country": "Norfolk Island", "iso3": "NFK", "iso2": "NF"}, {"country": "Northern Mariana Islands", "iso3": "MNP", "iso2": "MP"}, {"country": "Norway", "iso3": "NOR", "iso2": "NO"}, {"country": "Oman", "iso3": "OMN", "iso2": "OM"}, {"country": "Pakistan", "iso3": "PAK", "iso2": "PK"}, {"country": "Palau", "iso3": "PLW", "iso2": "PW"}, {"country": "Palestine, State of", "iso3": "PSE", "iso2": "PS"}, {"country": "Panama", "iso3": "PAN", "iso2": "PA"}, {"country": "Papua New Guinea", "iso3": "PNG", "iso2": "PG"}, {"country": "Paraguay", "iso3": "PRY", "iso2": "PY"}, {"country": "Peru", "iso3": "PER", "iso2": "PE"}, {"country": "Philippines", "iso3": "PHL", "iso2": "PH"}, {"country": "Pitcairn", "iso3": "PCN", "iso2": "PN"}, {"country": "Poland", "iso3": "POL", "iso2": "PL"}, {"country": "Portugal", "iso3": "PRT", "iso2": "PT"}, {"country": "Puerto Rico", "iso3": "PRI", "iso2": "PR"}, {"country": "Qatar", "iso3": "QAT", "iso2": "QA"}, {"country": "Reunion", "iso3": "REU", "iso2": "RE"}, {"country": "Romania", "iso3": "ROU", "iso2": "RO"}, {"country": "Russian Federation", "iso3": "RUS", "iso2": "RU"}, {"country": "Rwanda", "iso3": "RWA", "iso2": "RW"}, {"country": "Saint Barthélemy", "iso3": "BLM", "iso2": "BL"}, {"country": "Saint Helena, Ascension and Tristan da Cunha", "iso3": "SHN", "iso2": "SH"}, {"country": "Saint Kitts and Nevis", "iso3": "KNA", "iso2": "KN"}, {"country": "Saint Lucia", "iso3": "LCA", "iso2": "LC"}, {"country": "Saint Martin (French part)", "iso3": "MAF", "iso2": "MF"}, {"country": "Saint Pierre and Miquelon", "iso3": "SPM", "iso2": "PM"}, {"country": "Saint Vincent and the Grenadines", "iso3": "VCT", "iso2": "VC"}, {"country": "Samoa", "iso3": "WSM", "iso2": "WS"}, {"country": "San Marino", "iso3": "SMR", "iso2": "SM"}, {"country": "Sao Tome and Principe", "iso3": "STP", "iso2": "ST"}, {"country": "Saudi Arabia", "iso3": "SAU", "iso2": "SA"}, {"country": "Senegal", "iso3": "SEN", "iso2": "SN"}, {"country": "Serbia", "iso3": "SRB", "iso2": "RS"}, {"country": "Seychelles", "iso3": "SYC", "iso2": "SC"}, {"country": "Sierra Leone", "iso3": "SLE", "iso2": "SL"}, {"country": "Singapore", "iso3": "SGP", "iso2": "SG"}, {"country": "Sint Maarten (Dutch part)", "iso3": "SXM", "iso2": "SX"}, {"country": "Slovakia", "iso3": "SVK", "iso2": "SK"}, {"country": "Slovenia", "iso3": "SVN", "iso2": "SI"}, {"country": "Solomon Islands", "iso3": "SLB", "iso2": "SB"}, {"country": "Somalia", "iso3": "SOM", "iso2": "SO"}, {"country": "South Africa", "iso3": "ZAF", "iso2": "ZA"}, {"country": "South Georgia and the South Sandwich Islands", "iso3": "SGS", "iso2": "GS"}, {"country": "Spain", "iso3": "ESP", "iso2": "ES"}, {"country": "Sri Lanka", "iso3": "LKA", "iso2": "LK"}, {"country": "Sudan", "iso3": "SDN", "iso2": "SD"}, {"country": "Suriname", "iso3": "SUR", "iso2": "SR"}, {"country": "South Sudan", "iso3": "SSD", "iso2": "SS"}, {"country": "Svalbard and Jan Mayen", "iso3": "SJM", "iso2": "SJ"}, {"country": "Swaziland", "iso3": "SWZ", "iso2": "SZ"}, {"country": "Sweden", "iso3": "SWE", "iso2": "SE"}, {"country": "Switzerland", "iso3": "CHE", "iso2": "CH"}, {"country": "Syrian Arab Republic", "iso3": "SYR", "iso2": "SY"}, {"country": "Taiwan, Province of China", "iso3": "TWN", "iso2": "TW"}, {"country": "Tajikistan", "iso3": "TJK", "iso2": "TJ"}, {"country": "Tanzania, United Republic of", "iso3": "TZA", "iso2": "TZ"}, {"country": "Thailand", "iso3": "THA", "iso2": "TH"}, {"country": "Timor-Leste", "iso3": "TLS", "iso2": "TL"}, {"country": "Togo", "iso3": "TGO", "iso2": "TG"}, {"country": "Tokelau", "iso3": "TKL", "iso2": "TK"}, {"country": "Tonga", "iso3": "TON", "iso2": "TO"}, {"country": "Trinidad and Tobago", "iso3": "TTO", "iso2": "TT"}, {"country": "Tunisia", "iso3": "TUN", "iso2": "TN"}, {"country": "Turkey", "iso3": "TUR", "iso2": "TR"}, {"country": "Turkmenistan", "iso3": "TKM", "iso2": "TM"}, {"country": "Turks and Caicos Islands", "iso3": "TCA", "iso2": "TC"}, {"country": "Tuvalu", "iso3": "TUV", "iso2": "TV"}, {"country": "Uganda", "iso3": "UGA", "iso2": "UG"}, {"country": "Ukraine", "iso3": "UKR", "iso2": "UA"}, {"country": "United Arab Emirates", "iso3": "ARE", "iso2": "AE"}, {"country": "United Kingdom", "iso3": "GBR", "iso2": "GB"}, {"country": "United States", "iso3": "USA", "iso2": "US"}, {"country": "United States Minor Outlying Islands", "iso3": "UMI", "iso2": "UM"}, {"country": "Uruguay", "iso3": "URY", "iso2": "UY"}, {"country": "Uzbekistan", "iso3": "UZB", "iso2": "UZ"}, {"country": "Vanuatu", "iso3": "VUT", "iso2": "VU"}, {"country": "Venezuela, Bolivarian Republic of", "iso3": "VEN", "iso2": "VE"}, {"country": "Viet Nam", "iso3": "VNM", "iso2": "VN"}, {"country": "Virgin Islands, British", "iso3": "VGB", "iso2": "VG"}, {"country": "Virgin Islands, U.S.", "iso3": "VIR", "iso2": "VI"}, {"country": "Wallis and Futuna", "iso3": "WLF", "iso2": "WF"}, {"country": "Western Sahara", "iso3": "ESH", "iso2": "EH"}, {"country": "Yemen", "iso3": "YEM", "iso2": "YE"}, {"country": "Zambia", "iso3": "ZMB", "iso2": "ZM"}, {"country": "Zimbabwe", "iso3": "ZWE", "iso2": "ZW"}];
    $scope.new_assessment = {
        year: "",
        version: "",
        assessment_countries: [{}]
    };

    var cur_year = new Date().getFullYear(),
        years = [],
        i;

    for (i = 0; i < 6; i += 1) {
        years.push(cur_year + i);
    }

    $scope.years = years;


    $scope.closeDialog = function () {
        ngDialog.close();
    };

    $scope.countryAdd = function () {
        $scope.new_assessment.assessment_countries.push({country: ""});
    };

    $scope.countryDelete = function (index) {
        console.log(index);
        $scope.new_assessment.assessment_countries.splice(index, 1);
    };
    $scope.assessmentDeploy = function () {
        var newAssessmentData = [],
            newQuestionData = [];

        rgiQuestionSrvc.query({assessment_ID: 'base'}, function (data) {

            $scope.new_assessment.assessment_countries.forEach(function (el, i) {
                newAssessmentData.push({
                    assessment_ID: el.country.iso2 + "-" + String($scope.new_assessment.year) + "-" + $scope.new_assessment.version.slice(0, 2).toUpperCase(),
                    ISO3: el.country.iso3,
                    year: $scope.new_assessment.year,
                    version: $scope.new_assessment.version,
                    country: el.country.country
                });
            });
            // console.log(data);
            data.forEach(function (el, i) {
                newQuestionData.push({
                    root_QID: el._id,
                    assessment_ID: String($scope.new_assessment.year) + "-" + $scope.new_assessment.version.slice(0, 2).toUpperCase(),
                    component: el.component,
                    component_text: el.component_text,
                    indicator_name: el.indicator_name,
                    nrc_precept: el.nrc_precept,
                    old_reference: el.old_reference,
                    question_order: el.question_order,
                    question_choices: [],
                    question_text: el.question_text,
                    section_name: el.section_name,
                    sub_indicator_name: el.sub_indicator_name
                });

                el.question_choices.forEach(function (q_el, j) {
                    newQuestionData[newQuestionData.length - 1].question_choices.push({'criteria': q_el.criteria, 'name': q_el.name, 'order': q_el.order});
                });
            });

            // send to mongo
            rgiAssessmentMethodSrvc.createAssessment(newAssessmentData)
                .then(rgiQuestionMethodSrvc.insertQuestionSet(newQuestionData))
                .then(function () {
                    rgiNotifier.notify('Assessment deployed!');
                    $location.path('/admin/assessment-admin');
                }, function (reason) {
                    rgiNotifier.error(reason);
                });
        });
    };
});

// Angular capitilaize filter
angular.module('app').filter('capitalize', function () {
    return function (input) {
        return (!!input) ? input.replace(/([^\W_]+[^\s-]*) */g, function (txt) {return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); }) :  '';
    };
});